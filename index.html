<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>100 Level: Detektif Kota</title>
<meta name="description" content="Game detektif 100 level dengan variasi kasus, mode Hard, papan skor, ekspor/impor progres, tema terang/gelap, dan avatar kustom."/>
<style>
:root{--bg:#0b1220;--card:#101a2b;--muted:#98a2b3;--text:#e6edf3;--accent:#73d7ff;--ok:#22c55e;--bad:#ff6b6b}
*{box-sizing:border-box}body{margin:0;font:16px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;color:var(--text);background:linear-gradient(120deg,#0b1220 0%,#111a2c 100%);min-height:100vh;display:flex;flex-direction:column}
header{position:sticky;top:0;z-index:10;backdrop-filter:blur(8px);background:rgba(16,26,43,.7);border-bottom:1px solid #22304d;padding:.8rem 1rem;display:flex;gap:.6rem;align-items:center;flex-wrap:wrap}
header h1{font-size:1.05rem;margin:0}.pill{padding:.35rem .7rem;background:#0e172a;border:1px solid #1f2c48;border-radius:999px;color:#a8b3c6}
main{width:100%;max-width:1200px;margin:16px auto;padding:0 14px;flex:1;display:grid;gap:16px}
.two{display:grid;gap:14px;grid-template-columns:1.4fr .9fr}@media(max-width:980px){.two{grid-template-columns:1fr}}
.card{background:var(--card);border:1px solid #1f2c48;border-radius:18px;box-shadow:0 10px 35px rgba(0,0,0,.25)}.card .body{padding:16px 18px}
.title{font-weight:700;font-size:1.05rem}.muted{color:var(--muted)}.row{display:flex;flex-wrap:wrap;gap:10px}
.badge{background:#0f1a2d;border:1px solid #253454;color:#b8c2d6;padding:.3rem .55rem;border-radius:8px;font-size:.86rem}
.story{white-space:pre-wrap}
.suspects{display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(240px,1fr))}
.sus{border-radius:16px;overflow:hidden;border:1px solid #22314e;background:#0f182a;display:flex;flex-direction:column}
.sus header{display:flex;align-items:center;gap:10px;padding:12px 14px;border-bottom:1px solid #1d2a45;background:#0e1627}
.ava{font-size:28px;width:42px;height:42px;display:grid;place-items:center;background:#0b1324;border:1px solid #1f2b46;border-radius:12px;overflow:hidden}
.ava img{width:100%;height:100%;object-fit:cover}
.sus .body{padding:12px 14px;flex:1}.sus .meta{display:flex;gap:8px;flex-wrap:wrap}
.foot{display:flex;justify-content:space-between;align-items:center;padding:10px 14px;border-top:1px solid #1d2a45;background:#0e1627}
button{appearance:none;border:1px solid #2b3f63;background:#0e172a;color:#e6edf3;padding:.6rem 1rem;border-radius:12px;cursor:pointer;font-weight:600;transition:.2s transform,.2s background}
button.primary{background:linear-gradient(180deg,#0d9cf3,#0676be);border-color:#0c7dd3}
button.success{background:linear-gradient(180deg,#22c55e,#16a34a);border-color:#16a34a}
button:active{transform:translateY(1px)}
.progress{height:10px;border-radius:10px;background:#0d1527;border:1px solid #1f2b48;overflow:hidden}.progress>i{display:block;height:100%;background:linear-gradient(90deg,#4cc9f0,#22c55e);width:0%}
.toast{padding:.65rem .85rem;border:1px solid #263758;background:#0e192c;border-radius:10px}.ok{color:#a6f4c5}.bad{color:#ffb3b3}.small{font-size:.88rem}
footer{padding:18px 14px;text-align:center;color:#93a0b3}.tbl{width:100%;border-collapse:separate;border-spacing:0 8px}
.tbl th,.tbl td{padding:8px 10px}.tbl tr{background:#0e1627;border:1px solid #1f2b46}
.hidden{display:none}
</style>
</head>
<body>
<header>
  <h1>🕵️‍♂️ 100 Level: Detektif Kota</h1>
  <span id="levelBadge" class="pill">Level 1 / 100</span>
  <span id="scoreBadge" class="pill">Skor 0</span>
  <span id="modeBadge" class="pill">Mode: Normal</span>
  <div class="pill" id="detBadge">Detektif: —</div>
  <div class="pill" id="lokBadge">Lokasi: —</div>
  <div style="flex:1"></div>
  <button id="btnTema" class="pill">Tema: Gelap</button>
  <button id="btnMode" class="pill">Switch Hard</button>
  <button id="btnReset" class="pill">Reset</button>
  <button id="btnExport" class="pill">Ekspor</button>
  <label class="pill" style="cursor:pointer">Impor <input id="fileImport" type="file" accept="application/json" class="hidden"></label>
</header>

<main class="two">
  <section class="card">
    <div class="body" style="display:grid;gap:16px">
      <div class="title">📂 Kasus</div>
      <div id="story" class="story"></div>

      <div class="row">
        <span class="badge" id="badgeLok"></span>
        <span class="badge" id="badgeWaktu"></span>
        <span class="badge" id="badgeJenis"></span>
        <span class="badge" id="badgePartner"></span>
      </div>

      <div class="title">👥 Tersangka</div>
      <div id="suspects" class="suspects"></div>

      <div class="row">
        <button id="btnKunci" class="primary">Kunci Jawaban</button>
        <button id="btnHint">Beri Petunjuk</button>
        <button id="btnLewati">Lewati Level</button>
      </div>

      <div id="result" class="toast small hidden"></div>

      <div class="row" style="align-items:center;gap:12px">
        <div style="min-width:80px">Kemajuan</div>
        <div class="progress" style="flex:1"><i id="prog"></i></div>
        <button id="btnNext" class="success hidden">Lanjut ➜</button>
      </div>
    </div>
  </section>

  <aside class="card">
    <div class="body" style="display:grid;gap:16px">
      <div class="title">🧭 Navigasi</div>
      <div class="row"><input id="goto" type="number" min="1" max="100" value="1" class="pill" style="width:120px"><button id="btnGoto">Ke Level</button></div>

      <div class="title">🎮 Profil</div>
      <div class="row"><input id="nick" class="pill" placeholder="Nickname" style="flex:1;min-width:160px"><button id="btnSaveNick">Simpan</button></div>
      <div class="muted small">Nama dipakai saat kirim skor ke papan skor.</div>

      <div class="title">🏆 Papan Skor</div>
      <table class="tbl" id="board"><thead><tr><th>#</th><th>Nama</th><th>Skor</th><th>Mode</th><th>Waktu</th></tr></thead><tbody></tbody></table>
      <div class="row"><button id="btnSubmitScore" class="success">Kirim Skor</button><button id="btnRefreshBoard">Refresh</button></div>
    </div>
  </aside>
</main>

<footer>© 2025 — Detektif Kota. Semua fiksi.</footer>

<script>
/* ================= Util & Data ================= */
class PRNG{constructor(s){this.s=s>>>0}next(){this.s=(1664525*this.s+1013904223)>>>0;return this.s/2**32}pick(a){return a[Math.floor(this.next()*a.length)]}}
const $=q=>document.querySelector(q), $$=q=>document.querySelectorAll(q);
function esc(s){return (s||"").replace(/[&<>"']/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m]))}
function timeago(ts){const s=Math.floor((Date.now()-ts)/1000);if(s<60)return s+" dtk lalu";const m=Math.floor(s/60);if(m<60)return m+" mnt lalu";const h=Math.floor(m/60);if(h<24)return h+" jam lalu";const d=Math.floor(h/24);return d+" hari lalu"}

const TOTAL=100;
const DETEKTIF=["Arga","Bela","Cipta","Dewi","Eko","Farah","Gilang","Hana","Indra","Joko","Kyla","Lia","Miko","Nara","Ojan","Putri","Qila","Rino","Salsa","Tegar","Vino","Wulan","Xena","Yuda","Zara"];
const KOTA=["Jakarta","Bandung","Surabaya","Yogyakarta","Semarang","Medan","Makassar","Denpasar","Solo","Palembang"];
const TEMPAT=["galeri seni","perpustakaan","stasiun","pasar malam","museum","taman kota","kafe","hotel","gudang","kantor"];
const JENIS=["pencurian artefak","peretasan server","pemalsuan dokumen","sabotase listrik","penculikan misterius","perampokan bank kecil","pencurian lukisan","kebocoran data","penggelapan","pemerasan"];
const WAKTU=["dini hari","pagi","siang","sore","malam","tengah malam"];
const MITRA=[["Riko","analisis sidik jari"],["Maya","ahli gerak tubuh"],["Seno","spesialis CCTV"],["Vira","pakar digital"],["Bara","intel jalanan"]];
const CIRI=["bekas luka di wajah","suara serak","jalan pincang","bau rokok","tangan kidal","tato naga","sering batuk","bicara cepat","mata sayu","senyum dingin"];
const ALIBI=["pesan kopi","menunggu ojek","perbaiki ponsel","latihan vokal","mencari toilet","telpon ibu","vlog","antar paket","cari parkir","bantu satpam"];
const AVA=["🦊","🐱","🐶","🐵","🦁","🦉","🦄","🐸","👩","👨","🧔"];

/* ================= State ================= */
const store={get(){try{return JSON.parse(localStorage.getItem("detektif100")||"{}")}catch{return {}}},set(v){localStorage.setItem("detektif100",JSON.stringify(v))}};
let state=Object.assign({level:1,score:0,unlocked:1,mode:"normal",nick:"",theme:"dark"},store.get());

/* ================= Generator ================= */
function genLevel(n, hard=false){
  const rng=new PRNG(1000+n*77+(hard?999:0));
  const det=DETEKTIF[n%DETEKTIF.length];
  const kota=rng.pick(KOTA), tempat=rng.pick(TEMPAT);
  const jenis=rng.pick(JENIS), waktu=rng.pick(WAKTU);
  const [partner,keahlian]=rng.pick(MITRA);
  const ciriPelaku=rng.pick(CIRI);
  const suspects=[];
  for(let i=0;i<(hard?5:3);i++){
    suspects.push({
      id:i,
      name:"Tersangka "+(i+1),
      emoji:rng.pick(AVA),
      ciri:rng.pick(CIRI),
      alibi:rng.pick(ALIBI),
      avatar:`static/avatars/${(i%5)+1}.png`
    });
  }
  const culpritIndex=Math.floor(rng.next()*suspects.length);
  suspects[culpritIndex].ciri=ciriPelaku;
  const story=`Kasus ${jenis} terjadi di ${tempat} ${kota} pada ${waktu}.
Detektif ${det} ditemani ${partner} (ahli ${keahlian}).
Saksi menyebut pelaku punya ciri khas: ${ciriPelaku}.`;
  return {n,det,kota,tempat,jenis,waktu,partner,keahlian,ciriPelaku,suspects,culpritIndex,story};
}

/* ================= Render ================= */
function render(level){
  const L=genLevel(level,state.mode==="hard");
  $("#story").textContent=L.story;
  $("#badgeLok").textContent=`Lokasi: ${L.tempat}, ${L.kota}`;
  $("#badgeWaktu").textContent=`Waktu: ${L.waktu}`;
  $("#badgeJenis").textContent=`Kasus: ${L.jenis}`;
  $("#badgePartner").textContent=`Partner: ${L.partner}`;
  $("#detBadge").textContent=`Detektif: ${L.det}`;
  $("#lokBadge").textContent=`Lokasi: ${L.tempat}, ${L.kota}`;
  const wrap=$("#suspects");wrap.innerHTML="";
  L.suspects.forEach(s=>{
    const el=document.createElement("div");
    el.className="sus";
    el.innerHTML=`<header><div class="ava">${s.emoji||""}<img src="${s.avatar}" onerror="this.style.display='none'"></div>
    <div><b>${s.name}</b><div class="muted small">alibi: ${s.alibi}</div></div></header>
    <div class="body"><div class="meta small"><span class="badge">Ciri: ${s.ciri}</span></div></div>
    <div class="foot"><label class="small"><input type="radio" name="pick" value="${s.id}"> Pilih</label></div>`;
    wrap.appendChild(el);
  });
  render.current=L; setProgress();
}
function setProgress(){
  $("#levelBadge").textContent=`Level ${state.level} / ${TOTAL}`;
  $("#scoreBadge").textContent=`Skor ${state.score}`;
  $("#modeBadge").textContent=`Mode: ${state.mode}`;
  $("#prog").style.width=`${(state.unlocked-1)/TOTAL*100}%`;
  $("#goto").value=state.level;
}

/* ================= Events ================= */
$("#btnKunci").onclick=()=>{const L=render.current;const pick=[...$$('input[name="pick"]')].find(x=>x.checked);if(!pick){alert("Pilih tersangka!");return}const ok=(+pick.value)===L.culpritIndex;if(ok){state.score+=state.mode==="hard"?12:10;alert("Benar!");state.unlocked=Math.max(state.unlocked,state.level+1)}else{state.score=Math.max(0,state.score-(state.mode==="hard"?5:3));alert("Salah. Pelaku punya ciri: "+L.ciriPelaku)}store.set(state);setProgress();};
$("#btnNext").onclick=()=>{state.level=Math.min(100,state.level+1);render(state.level)};
$("#btnGoto").onclick=()=>{const v=+$("#goto").value||1;if(v<=state.unlocked){state.level=v;render(state.level)}else alert("Belum terbuka")};
$("#btnTema").onclick=()=>{state.theme=state.theme==="dark"?"light":"dark";document.body.style.background=state.theme==="dark"?"#111":"#fff";store.set(state)};
$("#btnMode").onclick=()=>{state.mode=state.mode==="hard"?"normal":"hard";store.set(state);render(state.level)};
$("#btnReset").onclick=()=>{if(confirm("Reset?")){state={level:1,score:0,unlocked:1,mode:"normal"};store.set(state);render(1)}};

/* Init */
render(state.level);
</script>
</body>
</html>
