<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detective Chronicles - 100 Misteri</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #34495e;
            --accent-color: #e74c3c;
            --hard-color: #c0392b;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --light-color: #ecf0f1;
            --text-color: #333;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #1a1a2e;
            color: var(--light-color);
            line-height: 1.6;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(255, 0, 0, 0.05) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(255, 0, 0, 0.05) 0%, transparent 20%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 20px 0;
            border-bottom: 2px solid var(--accent-color);
            margin-bottom: 30px;
            position: relative;
        }

        h1 {
            font-size: 2.8rem;
            color: var(--accent-color);
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            margin-bottom: 10px;
            letter-spacing: 1px;
        }

        .difficulty-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
            background: var(--secondary-color);
            padding: 8px 15px;
            border-radius: 30px;
            cursor: pointer;
            transition: var(--transition);
        }

        .difficulty-toggle:hover {
            background: var(--primary-color);
        }

        .difficulty-toggle.hard {
            background: var(--hard-color);
        }

        .toggle-text {
            margin-right: 8px;
            font-weight: bold;
        }

        .toggle-indicator {
            width: 20px;
            height: 20px;
            background: var(--light-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .game-screen {
            display: none;
            background-color: rgba(44, 62, 80, 0.9);
            border-radius: 10px;
            padding: 25px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        #start-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .level-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 12px;
            margin: 25px 0;
            max-height: 400px;
            overflow-y: auto;
            padding: 10px;
        }

        .level-button {
            background: var(--secondary-color);
            border: none;
            color: white;
            width: 80px;
            height: 80px;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .level-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .level-button.completed {
            background: var(--success-color);
        }

        .level-button.hard-level {
            background: var(--hard-color);
        }

        .level-button.current {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(231, 76, 60, 0); }
            100% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0); }
        }

        .level-difficulty {
            font-size: 0.7rem;
            margin-top: 5px;
            opacity: 0.8;
        }

        .dialog-box {
            background-color: var(--secondary-color);
            border-left: 4px solid var(--accent-color);
            padding: 20px;
            margin-bottom: 25px;
            border-radius: 0 8px 8px 0;
            line-height: 1.8;
        }

        .choices {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            margin: 25px 0;
        }

        .choice-btn {
            background-color: var(--primary-color);
            color: var(--light-color);
            border: none;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            text-align: left;
            font-size: 1rem;
        }

        .choice-btn:hover {
            background-color: var(--accent-color);
            transform: translateY(-3px);
        }

        .inventory {
            background-color: var(--secondary-color);
            padding: 20px;
            border-radius: 8px;
            margin-top: 25px;
        }

        .inventory h3 {
            margin-bottom: 15px;
            color: var(--accent-color);
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 8px;
        }

        .inventory-items {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        .inventory-item {
            background-color: var(--primary-color);
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
        }

        .inventory-item::before {
            content: "â€¢";
            margin-right: 5px;
            color: var(--accent-color);
        }

        .characters {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            margin: 25px 0;
            gap: 20px;
        }

        .character {
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            flex: 1;
            min-width: 120px;
        }

        .character:hover {
            transform: scale(1.05);
        }

        .character-img {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--accent-color);
            margin-bottom: 10px;
        }

        .progress-container {
            width: 100%;
            background-color: var(--secondary-color);
            border-radius: 8px;
            margin: 25px 0;
            height: 15px;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-color), #f39c12);
            border-radius: 8px;
            width: 0%;
            transition: width 0.7s ease;
        }

        .btn {
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            margin: 15px;
            transition: var(--transition);
            font-weight: bold;
        }

        .btn:hover {
            background-color: #c0392b;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .hint-btn {
            background-color: #f39c12;
            padding: 10px 20px;
            font-size: 0.9rem;
        }

        .level-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            padding: 0 10px;
        }

        .level-info span {
            background: var(--secondary-color);
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
        }

        .hard-mode-effect {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            background: rgba(199, 0, 0, 0.03);
            z-index: 100;
            animation: redPulse 15s infinite;
        }

        @keyframes redPulse {
            0% { background: rgba(199, 0, 0, 0.03); }
            50% { background: rgba(199, 0, 0, 0.08); }
            100% { background: rgba(199, 0, 0, 0.03); }
        }

        footer {
            text-align: center;
            margin-top: auto;
            padding: 25px;
            border-top: 1px solid var(--secondary-color);
            font-size: 0.9rem;
        }

        @media (min-width: 768px) {
            .choices {
                grid-template-columns: 1fr 1fr;
            }
            
            h1 {
                font-size: 3.5rem;
            }
        }

        @media (max-width: 480px) {
            .level-grid {
                grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            }
            
            .level-button {
                width: 60px;
                height: 60px;
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="hard-mode-effect" id="hard-mode-effect" style="display: none;"></div>
    
    <div class="container">
        <header>
            <h1>Detective Chronicles</h1>
            <p>100 Misteri Unik dengan Karakter dan Cerita Berbeda!</p>
            <div class="difficulty-toggle" id="difficulty-toggle">
                <span class="toggle-text">Easy</span>
                <div class="toggle-indicator">H</div>
            </div>
        </header>

        <section id="start-screen" class="game-screen">
            <div class="dialog-box">
                <p>Selamat datang di Detective Chronicles, game detektif dengan 100 level misteri yang masing-masing memiliki cerita dan karakter unik. Setiap kasus menawarkan tantangan berbeda yang harus Anda pecahkan.</p>
                <p>Anda dapat beralih ke mode Hard untuk tantangan ekstra dengan lebih sedikit petunjuk dan lebih banyak kebingungan!</p>
            </div>
            <button id="start-btn" class="btn">Pilih Level</button>
        </section>

        <section id="level-select-screen" class="game-screen">
            <h2>Pilih Level</h2>
            <p>Progress: <span id="progress-percent">0</span>% selesai (<span id="completed-levels">0</span>/100 level)</p>
            
            <div class="level-grid" id="level-grid">
                <!-- Level buttons will be generated here -->
            </div>
            
            <button id="back-to-menu" class="btn">Kembali ke Menu</button>
        </section>

        <section id="investigation-screen" class="game-screen">
            <div class="level-info">
                <span>Level: <span id="current-level">1</span> - <span id="case-title">Misteri Villa Tua</span></span>
                <span id="level-difficulty-badge">Mode: Normal</span>
            </div>
            
            <h2>Lokasi: <span id="current-location">Perpustakaan</span></h2>
            <div class="progress-container">
                <div class="progress-bar" id="progress-bar"></div>
            </div>
            
            <div class="dialog-box" id="location-description">
                <p>Tuan Harrington ditemukan terbaring di dekat perapian. Ada luka di kepalanya, dan sebuah pecahan vas bunga tergeletak di dekatnya. Ruangan ini agak berantakan, sepertinya ada perlawanan.</p>
            </div>
            
            <div class="characters" id="characters-container">
                <!-- Characters will be generated here -->
            </div>
            
            <div class="choices" id="location-choices">
                <!-- Location choices will be generated here -->
            </div>
            
            <div class="inventory">
                <h3>Inventory</h3>
                <div class="inventory-items" id="inventory">
                    <div class="inventory-item">Notebook</div>
                    <div class="inventory-item">Pena</div>
                </div>
            </div>
        </section>

        <section id="interrogation-screen" class="game-screen">
            <h2>Interogasi: <span id="suspect-name">Nama Suspek</span></h2>
            
            <div class="dialog-box" id="suspect-dialog">
                <p>Selamat sore, Detektif. Ada yang bisa saya bantu?</p>
            </div>
            
            <div class="choices" id="interrogation-choices">
                <!-- Questions will be generated here -->
            </div>
        </section>

        <section id="conclusion-screen" class="game-screen">
            <h2>Selesaikan Kasus</h2>
            
            <div class="dialog-box">
                <p>Anda telah mengumpulkan semua bukti. Siapa menurut Anda pembunuhnya?</p>
            </div>
            
            <div class="choices" id="accusation-choices">
                <!-- Accusation options will be generated here -->
            </div>
        </section>
    </div>

    <footer>
        <p>Detective Chronicles &copy; 2023 - 100 Misteri Unik dengan Karakter Berbeda</p>
    </footer>

    <script>
        // Game state
        let gameState = {
            currentScreen: 'start',
            currentLevel: 1,
            difficulty: 'normal',
            progress: 0,
            currentLocation: 'library',
            currentSuspect: null,
            inventory: ['Notebook', 'Pena'],
            clues: {},
            conversations: {},
            hints: 3,
            completedLevels: [],
            levelProgress: {}
        };

        // Generate 100 unique levels with different stories and characters
        const levelData = {
            1: {
                title: "Misteri Villa Tua",
                description: "Tuan James Harrington ditemukan tewas di perpustakaannya. Lima orang berada di villa saat kejadian, dan masing-masing memiliki motif.",
                startingLocation: "library",
                locations: {
                    library: {
                        name: "Perpustakaan",
                        description: "Tuan Harrington ditemukan terbaring di dekat perapian. Ada luka di kepalanya, dan sebuah pecahan vas bunga tergeletak di dekatnya.",
                        choices: [
                            { text: "Periksa vas pecah", action: "examine", target: "vas" },
                            { text: "Periksa tubuh korban", action: "examine", target: "body" },
                            { text: "Periksa jendela", action: "examine", target: "window" },
                            { text: "Pergi ke Aula", action: "move", target: "hall" }
                        ]
                    },
                    hall: {
                        name: "Aula",
                        description: "Aula besar dengan tangga mewah. Ada lukisan keluarga Harrington tergantung di dinding.",
                        choices: [
                            { text: "Periksa lukisan", action: "examine", target: "painting" },
                            { text: "Pergi ke Perpustakaan", action: "move", target: "library" },
                            { text: "Pergi ke Dapur", action: "move", target: "kitchen" }
                        ]
                    }
                },
                characters: {
                    butler: {
                        name: "Charles, Butler",
                        description: "Telah melayani keluarga Harrington selama 20 tahun.",
                        questions: {
                            whereabouts: "Di mana Anda saat kejadian?",
                            relationship: "Apa hubungan Anda dengan korban?",
                            alibi: "Apakah Anda memiliki alibi?"
                        },
                        responses: {
                            whereabouts: "Saya sedang merapikan perpustakaan sekitar setengah jam sebelum kejadian. Setelah itu, saya pergi ke dapur.",
                            relationship: "Saya telah melayani keluarga Harrington selama 20 tahun. Tuan James seperti keluarga bagi saya.",
                            alibi: "Saya berada di dapur bersama kepala koki ketika teriakan terdengar."
                        }
                    },
                    wife: {
                        name: "Eleanor, Istri Almarhum",
                        description: "Istri kedua Tuan Harrington, berusia 30 tahun lebih muda.",
                        questions: {
                            whereabouts: "Di mana Anda saat kejadian?",
                            relationship: "Apa hubungan Anda dengan korban?",
                            alibi: "Apakah Anda memiliki alibi?"
                        },
                        responses: {
                            whereabouts: "Saya sedang beristirahat di kamar saya. Saya merasa tidak enak badan sejak sore.",
                            relationship: "James adalah suami saya. Kami sudah menikah selama 5 tahun.",
                            alibi: "Sayangnya, saya sendirian di kamar. Tidak ada yang bisa membuktikan."
                        }
                    }
                },
                clues: {
                    vas: {
                        name: "Pecahan Vas",
                        description: "Vas antik dari Dinasti Ming. Ada sidik jari pada beberapa pecahan. Terlihat ada noda darah di salah satu pecahan.",
                        found: false
                    },
                    body: {
                        name: "Tubuh Korban",
                        description: "Luka di kepala konsisten dengan pukulan benda tumpul. Jam tangan korban berhenti pada pukul 21:45.",
                        found: false
                    }
                },
                solution: "butler"
            },
            2: {
                title: "Misteri Galeri Seni",
                description: "Sebuah lukisan berharga dicuri dari galeri seni ternama. Empat orang berada di lokasi saat kejadian.",
                startingLocation: "gallery",
                locations: {
                    gallery: {
                        name: "Galeri Utama",
                        description: "Ruang pamer utama dengan dinding kosong tempat lukisan itu sebelumnya dipajang. Kaca pelindung pecah berantakan di lantai.",
                        choices: [
                            { text: "Periksa kaca pecah", action: "examine", target: "glass" },
                            { text: "Periksa sistem keamanan", action: "examine", target: "security" },
                            { text: "Pergi ke Ruang Penyimpanan", action: "move", target: "storage" }
                        ]
                    },
                    storage: {
                        name: "Ruang Penyimpanan",
                        description: "Ruang ini berisi lukisan-lukisan yang tidak sedang dipamerkan. Terdapat bau cat yang kuat.",
                        choices: [
                            { text: "Periksa cat", action: "examine", target: "paint" },
                            { text: "Pergi ke Galeri Utama", action: "move", target: "gallery" }
                        ]
                    }
                },
                characters: {
                    curator: {
                        name: "Budi, Kurator",
                        description: "Bekerja di galeri selama 10 tahun, sangat mengetahui nilai setiap karya.",
                        questions: {
                            whereabouts: "Di mana Anda saat kejadian?",
                            relationship: "Apa pendapat Anda tentang lukisan yang hilang?",
                            alibi: "Apakah Anda memiliki alibi?"
                        },
                        responses: {
                            whereabouts: "Saya sedang mengatur pameran baru di ruang belakang.",
                            relationship: "Lukisan itu adalah mahakarya. Sangat disayangkan hilang.",
                            alibi: "Saya bersama asisten kurator saat alarm berbunyi."
                        }
                    },
                    artist: {
                        name: "Sari, Seniman",
                        description: "Seniman lokal yang karyanya sedang dipamerkan di galeri.",
                        questions: {
                            whereabouts: "Di mana Anda saat kejadian?",
                            relationship: "Apa pendapat Anda tentang lukisan yang hilang?",
                            alibi: "Apakah Anda memiliki alibi?"
                        },
                        responses: {
                            whereabouts: "Saya sedang menyiapkan karya saya di ruang pamer samping.",
                            relationship: "Lukisan itu terlalu tradisional untuk selera saya.",
                            alibi: "Saya sendirian saat itu, menikmati keheningan galeri."
                        }
                    }
                },
                clues: {
                    glass: {
                        name: "Kaca Pecah",
                        description: "Kaca pelindung yang pecah. Pecahannya ada di dalam, menandakan lukisan didorong dari luar.",
                        found: false
                    },
                    security: {
                        name: "Sistem Keamanan",
                        description: "Sistem keamanan dimatikan dari dalam tepat sebelum pencurian.",
                        found: false
                    }
                },
                solution: "curator"
            },
            3: {
                title: "Misteri Laboratorium",
                description: "Ilmuwan senior ditemukan tewas di laboratorium rahasia. Formula penting hilang dari brankas.",
                startingLocation: "lab",
                locations: {
                    lab: {
                        name: "Laboratorium Utama",
                        description: "Ruangan penuh dengan peralatan ilmiah. Bau bahan kimia menyengat. Meja kerja berantakan dengan kertas berserakan.",
                        choices: [
                            { text: "Periksa meja kerja", action: "examine", target: "desk" },
                            { text: "Periksa brankas", action: "examine", target: "safe" },
                            { text: "Pergi ke Ruang Server", action: "move", target: "server" }
                        ]
                    },
                    server: {
                        name: "Ruang Server",
                        description: "Ruangan dingin berisi komputer dan server. Monitor masih menampilkan data penelitian.",
                        choices: [
                            { text: "Periksa log komputer", action: "examine", target: "computer" },
                            { text: "Pergi ke Laboratorium Utama", action: "move", target: "lab" }
                        ]
                    }
                },
                characters: {
                    assistant: {
                        name: "Dr. Ahmad, Asisten",
                        description: "Asisten laboratorium yang ambisius, bekerja di bawah korban.",
                        questions: {
                            whereabouts: "Di mana Anda saat kejadian?",
                            relationship: "Apa hubungan Anda dengan korban?",
                            alibi: "Apakah Anda memiliki alibi?"
                        },
                        responses: {
                            whereabouts: "Saya sedang melakukan percobaan di ruang sebelah.",
                            relationship: "Saya bekerja sebagai asisten Dr. Surya selama 3 tahun.",
                            alibi: "Tidak ada yang melihat saya saat itu. Saya sendirian di lab kecil."
                        }
                    },
                    intern: {
                        name: "Maya, Magang",
                        description: "Magang yang baru bergabung 2 bulan lalu, sangat antusias.",
                        questions: {
                            whereabouts: "Di mana Anda saat kejadian?",
                            relationship: "Apa hubungan Anda dengan korban?",
                            alibi: "Apakah Anda memiliki alibi?"
                        },
                        responses: {
                            whereabouts: "Saya sedang mengatur bahan kimia di gudang penyimpanan.",
                            relationship: "Dr. Surya adalah mentor saya. Dia sangat membantu.",
                            alibi: "Saya bertemu penjaga keamanan sekitar waktu kejadian."
                        }
                    }
                },
                clues: {
                    desk: {
                        name: "Meja Kerja",
                        description: "Terdapat catatan tentang formula yang hilang. Ada coretan 'jangan percaya siapa pun' di sudutnya.",
                        found: false
                    },
                    safe: {
                        name: "Brankas",
                        description: "Brankas dibuka dengan kombinasi, bukan dibongkar. Tidak ada tanda-tanda paksa.",
                        found: false
                    }
                },
                solution: "assistant"
            }
        };

        // Generate 97 more unique levels
        for (let i = 4; i <= 100; i++) {
            const themes = [
                "Misteri Hotel", "Pembunuhan di Kereta", "Konspirasi Museum", 
                "Pencurian Kripto", "Spionase Corporate", "Misteri Keluarga", 
                "Konspirasi Politik", "Penipuan Finansial", "Misteri Teknologi"
            ];
            
            const locations = [
                "Hotel Bersejarah", "Kereta Api Ekspres", "Museum Nasional", 
                "Markas Perusahaan", "Konsulat Asing", "Rumah Mewah", 
                "Gedung Pemerintah", "Bank Internasional", "Laboratorium Rahasia"
            ];
            
            const characters = [
                "Manajer", "Sopir", "Kurator", "CEO", "Diplomat", "Ahli Waris", 
                "Menteri", "Bankir", "Ilmuwan", "Detektif Swasta", "Jurnalis", "Security"
            ];
            
            const randomTheme = themes[Math.floor(Math.random() * themes.length)];
            const randomLocation = locations[Math.floor(Math.random() * locations.length)];
            const randomCharacter1 = characters[Math.floor(Math.random() * characters.length)];
            const randomCharacter2 = characters[Math.floor(Math.random() * characters.length)];
            
            // Make sure characters are different
            const character2 = randomCharacter1 === randomCharacter2 ? 
                characters[(characters.indexOf(randomCharacter2) + 1) % characters.length] : 
                randomCharacter2;
            
            levelData[i] = {
                title: `${randomTheme} - Bagian ${i-3}`,
                description: `Sebuah ${randomTheme.toLowerCase()} terjadi di ${randomLocation}. ${i % 4 === 0 ? 'Beberapa orang' : 'Dua orang'} berada di lokasi saat kejadian.`,
                startingLocation: "scene",
                locations: {
                    scene: {
                        name: randomLocation,
                        description: `Anda tiba di ${randomLocation}. Terdapat tanda-tanda kejahatan yang jelas terlihat.`,
                        choices: [
                            { text: "Periksa area kejadian", action: "examine", target: "scene" },
                            { text: "Cari bukti tambahan", action: "examine", target: "evidence" },
                            { text: "Pergi ke Ruang Administrasi", action: "move", target: "office" }
                        ]
                    },
                    office: {
                        name: "Ruang Administrasi",
                        description: "Ruangan ini berisi dokumen dan catatan penting. Komputer masih menyala.",
                        choices: [
                            { text: "Periksa dokumen", action: "examine", target: "documents" },
                            { text: "Periksa komputer", action: "examine", target: "computer" },
                            { text: `Kembali ke ${randomLocation}`, action: "move", target: "scene" }
                        ]
                    }
                },
                characters: {
                    character1: {
                        name: `${randomCharacter1}`,
                        description: `${randomCharacter1} yang bertanggung jawab atas ${randomLocation}.`,
                        questions: {
                            question1: "Di mana Anda saat kejadian?",
                            question2: "Apa yang Anda ketahui tentang kejadian ini?",
                            question3: "Apakah Anda memiliki alibi?"
                        },
                        responses: {
                            question1: "Saya sedang melakukan patroli rutin di area lain.",
                            question2: "Saya tidak melihat atau mendengar sesuatu yang mencurigakan.",
                            question3: "Saya bersama rekan kerja saat kejadian terjadi."
                        }
                    },
                    character2: {
                        name: `${character2}`,
                        description: `${character2} yang juga berada di lokasi saat kejadian.`,
                        questions: {
                            question1: "Di mana Anda saat kejadian?",
                            question2: "Apa yang Anda ketahui tentang kejadian ini?",
                            question3: "Apakah Anda memiliki alibi?"
                        },
                        responses: {
                            question1: "Saya sedang menyelesaikan pekerjaan di ruang sebelah.",
                            question2: "Saya mendengar suara aneh tetapi mengabaikannya.",
                            question3: "Tidak ada yang melihat saya saat itu, sayangnya."
                        }
                    }
                },
                clues: {
                    scene: {
                        name: "TKP",
                        description: "Terdapat bukti-bukti penting yang dapat mengungkap kejadian sebenarnya.",
                        found: false
                    },
                    evidence: {
                        name: "Bukti Tambahan",
                        description: "Beberapa barang bukti yang tersembunyi tetapi penting untuk investigasi.",
                        found: false
                    }
                },
                solution: Math.random() > 0.5 ? "character1" : "character2"
            };
        }

        // Initialize the game
        document.addEventListener('DOMContentLoaded', function() {
            initializeGame();
            document.getElementById('start-btn').addEventListener('click', showLevelSelect);
            document.getElementById('back-to-menu').addEventListener('click', showStartScreen);
            document.getElementById('difficulty-toggle').addEventListener('click', toggleDifficulty);
        });

        function initializeGame() {
            updateInventory();
            updateProgress();
            generateLevelButtons();
            
            // Load game state from localStorage if available
            const savedGameState = localStorage.getItem('detectiveGameState');
            if (savedGameState) {
                const parsedState = JSON.parse(savedGameState);
                gameState = { ...gameState, ...parsedState };
                
                // Update UI based on loaded state
                updateLevelButtons();
                updateDifficultyToggle();
            }
        }

        function generateLevelButtons() {
            const levelGrid = document.getElementById('level-grid');
            levelGrid.innerHTML = '';
            
            for (let i = 1; i <= 100; i++) {
                const levelButton = document.createElement('button');
                levelButton.className = 'level-button';
                levelButton.textContent = i;
                levelButton.setAttribute('data-level', i);
                
                // Add difficulty badge for hard levels
                if (i % 4 === 0) {
                    const difficultyBadge = document.createElement('span');
                    difficultyBadge.className = 'level-difficulty';
                    difficultyBadge.textContent = 'H';
                    levelButton.appendChild(difficultyBadge);
                    levelButton.classList.add('hard-level');
                }
                
                // Mark completed levels
                if (gameState.completedLevels.includes(i)) {
                    levelButton.classList.add('completed');
                }
                
                // Mark current level
                if (i === gameState.currentLevel) {
                    levelButton.classList.add('current');
                }
                
                levelButton.addEventListener('click', () => startLevel(i));
                levelGrid.appendChild(levelButton);
            }
            
            // Update progress stats
            document.getElementById('completed-levels').textContent = gameState.completedLevels.length;
            document.getElementById('progress-percent').textContent = gameState.completedLevels.length;
        }

        function updateLevelButtons() {
            const levelButtons = document.querySelectorAll('.level-button');
            levelButtons.forEach(button => {
                const level = parseInt(button.getAttribute('data-level'));
                
                // Update completed status
                if (gameState.completedLevels.includes(level)) {
                    button.classList.add('completed');
                } else {
                    button.classList.remove('completed');
                }
                
                // Update current level
                if (level === gameState.currentLevel) {
                    button.classList.add('current');
                } else {
                    button.classList.remove('current');
                }
            });
            
            // Update progress stats
            document.getElementById('completed-levels').textContent = gameState.completedLevels.length;
            document.getElementById('progress-percent').textContent = gameState.completedLevels.length;
        }

        function toggleDifficulty() {
            const toggle = document.getElementById('difficulty-toggle');
            if (gameState.difficulty === 'normal') {
                gameState.difficulty = 'hard';
                toggle.classList.add('hard');
                document.querySelector('.toggle-text').textContent = 'Hard';
                document.getElementById('hard-mode-effect').style.display = 'block';
                
                // Update current level badge if in game
                if (document.getElementById('level-difficulty-badge')) {
                    document.getElementById('level-difficulty-badge').textContent = 'Mode: Hard';
                }
            } else {
                gameState.difficulty = 'normal';
                toggle.classList.remove('hard');
                document.querySelector('.toggle-text').textContent = 'Normal';
                document.getElementById('hard-mode-effect').style.display = 'none';
                
                // Update current level badge if in game
                if (document.getElementById('level-difficulty-badge')) {
                    document.getElementById('level-difficulty-badge').textContent = 'Mode: Normal';
                }
            }
            
            saveGameState();
        }

        function updateDifficultyToggle() {
            const toggle = document.getElementById('difficulty-toggle');
            if (gameState.difficulty === 'hard') {
                toggle.classList.add('hard');
                document.querySelector('.toggle-text').textContent = 'Hard';
                document.getElementById('hard-mode-effect').style.display = 'block';
            } else {
                toggle.classList.remove('hard');
                document.querySelector('.toggle-text').textContent = 'Normal';
                document.getElementById('hard-mode-effect').style.display = 'none';
            }
            
            // Update current level badge if in game
            if (document.getElementById('level-difficulty-badge')) {
                document.getElementById('level-difficulty-badge').textContent = `Mode: ${gameState.difficulty === 'hard' ? 'Hard' : 'Normal'}`;
            }
        }

        function showScreen(screenId) {
            document.querySelectorAll('.game-screen').forEach(screen => {
                screen.style.display = 'none';
            });
            
            document.getElementById(screenId).style.display = 'block';
            gameState.currentScreen = screenId;
        }

        function showStartScreen() {
            showScreen('start-screen');
        }

        function showLevelSelect() {
            showScreen('level-select-screen');
            updateLevelButtons();
        }

        function startLevel(level) {
            gameState.currentLevel = level;
            const levelInfo = levelData[level];
            
            // Initialize level progress if not exists
            if (!gameState.levelProgress[level]) {
                gameState.levelProgress[level] = {
                    clues: {},
                    conversations: {}
                };
            }
            
            showScreen('investigation-screen');
            
            // Update UI for current level
            document.getElementById('current-level').textContent = level;
            document.getElementById('case-title').textContent = levelInfo.title;
            document.getElementById('level-difficulty-badge').textContent = `Mode: ${gameState.difficulty === 'hard' ? 'Hard' : 'Normal'}`;
            
            // Adjust hints based on difficulty
            gameState.hints = gameState.difficulty === 'hard' ? 1 : 3;
            document.getElementById('hint-count').textContent = gameState.hints;
            
            // Reset level-specific state
            gameState.currentLocation = levelInfo.startingLocation;
            gameState.clues = JSON.parse(JSON.stringify(gameState.levelProgress[level].clues));
            gameState.conversations = JSON.parse(JSON.stringify(gameState.levelProgress[level].conversations));
            gameState.inventory = ['Notebook', 'Pena'];
            updateInventory();
            
            // Load location data
            loadLocation(levelInfo.startingLocation);
            
            // Load characters
            loadCharacters();
            
            // Update progress bar
            updateProgress();
            
            saveGameState();
        }

        function loadLocation(locationId) {
            const levelInfo = levelData[gameState.currentLevel];
            const location = levelInfo.locations[locationId];
            
            gameState.currentLocation = locationId;
            
            document.getElementById('current-location').textContent = location.name;
            document.getElementById('location-description').innerHTML = `<p>${location.description}</p>`;
            
            // Update choices
            const choicesContainer = document.getElementById('location-choices');
            choicesContainer.innerHTML = '';
            
            location.choices.forEach(choice => {
                const button = document.createElement('button');
                button.className = 'choice-btn';
                button.textContent = choice.text;
                
                if (choice.action === 'examine') {
                    button.onclick = () => examine(choice.target);
                } else if (choice.action === 'move') {
                    button.onclick = () => moveLocation(choice.target);
                }
                
                choicesContainer.appendChild(button);
            });
            
            // Add hint button
            const hintButton = document.createElement('button');
            hintButton.className = 'choice-btn hint-btn';
            hintButton.innerHTML = `Gunakan Petunjuk (<span id="hint-count">${gameState.hints}</span> tersisa)`;
            hintButton.onclick = useHint;
            choicesContainer.appendChild(hintButton);
        }

        function loadCharacters() {
            const levelInfo = levelData[gameState.currentLevel];
            const charactersContainer = document.getElementById('characters-container');
            charactersContainer.innerHTML = '';
            
            for (const [key, character] of Object.entries(levelInfo.characters)) {
                const characterElement = document.createElement('div');
                characterElement.className = 'character';
                characterElement.onclick = () => interrogate(key);
                
                // Generate different avatar based on character
                const avatarColors = ['#d4bcbd', '#f8cace', '#bcd4e5', '#d4d4aa', '#c9b1bd'];
                const randomColor = avatarColors[Math.floor(Math.random() * avatarColors.length)];
                
                characterElement.innerHTML = `
                    <img src="data:image/svg+xml;base64,${btoa(`
                        <svg width="100" height="100" viewBox="0 0 100 100">
                            <circle cx="50" cy="35" r="25" fill="${randomColor}"/>
                            <circle cx="50" cy="35" r="30" stroke="#986d4b" stroke-width="2" fill="none"/>
                            <circle cx="40" cy="30" r="4" fill="#555"/>
                            <circle cx="60" cy="30" r="4" fill="#555"/>
                            <path d="M40 45 Q50 55 60 45" stroke="#555" stroke-width="2" fill="none"/>
                        </svg>
                    `)}" alt="${character.name}" class="character-img">
                    <p>${character.name}</p>
                `;
                
                charactersContainer.appendChild(characterElement);
            }
        }

        function useHint() {
            if (gameState.hints > 0) {
                gameState.hints--;
                document.getElementById('hint-count').textContent = gameState.hints;
                
                // Provide a hint based on the current level
                const levelInfo = levelData[gameState.currentLevel];
                const hint = `Petunjuk: Coba periksa ${Object.keys(levelInfo.clues)[0]} dengan cermat.`;
                alert(hint);
                
                saveGameState();
            } else {
                alert("Anda kehabisan petunjuk!");
            }
        }

        function updateProgress() {
            // Calculate progress based on clues found and conversations had
            const levelInfo = levelData[gameState.currentLevel];
            const totalClues = Object.keys(levelInfo.clues).length;
            const foundClues = Object.values(gameState.clues).filter(clue => clue).length;
            
            const totalConversations = Object.keys(levelInfo.characters).length * 3; // 3 questions per character
            let completedConversations = 0;
            
            for (const character in gameState.conversations) {
                completedConversations += Object.keys(gameState.conversations[character] || {}).length;
            }
            
            const clueProgress = foundClues / totalClues;
            const conversationProgress = completedConversations / totalConversations;
            
            // Progress is average of both components
            const progress = (clueProgress + conversationProgress) / 2 * 100;
            document.getElementById('progress-bar').style.width = `${progress}%`;
            
            // If progress reaches 100%, enable accusation
            if (progress >= 100) {
                // You could add a button to accuse here
            }
        }

        function updateInventory() {
            const inventoryContainer = document.getElementById('inventory');
            inventoryContainer.innerHTML = '';
            
            gameState.inventory.forEach(item => {
                const itemElement = document.createElement('div');
                itemElement.className = 'inventory-item';
                itemElement.textContent = item;
                inventoryContainer.appendChild(itemElement);
            });
        }

        function moveLocation(locationId) {
            loadLocation(locationId);
        }

        function examine(objectId) {
            const levelInfo = levelData[gameState.currentLevel];
            
            if (levelInfo.clues[objectId] && !gameState.clues[objectId]) {
                gameState.clues[objectId] = true;
                gameState.levelProgress[gameState.currentLevel].clues[objectId] = true;
                
                // Add to inventory
                if (!gameState.inventory.includes(levelInfo.clues[objectId].name)) {
                    gameState.inventory.push(levelInfo.clues[objectId].name);
                    updateInventory();
                }
                
                // Show clue description
                alert(`Anda menemukan: ${levelInfo.clues[objectId].name}\n${levelInfo.clues[objectId].description}`);
                
                // Update progress
                updateProgress();
            } else if (levelInfo.clues[objectId]) {
                alert(`Anda sudah memeriksa ${levelInfo.clues[objectId].name}.`);
            }
            
            saveGameState();
        }

        function interrogate(characterId) {
            const levelInfo = levelData[gameState.currentLevel];
            const character = levelInfo.characters[characterId];
            
            gameState.currentSuspect = characterId;
            document.getElementById('suspect-name').textContent = character.name;
            document.getElementById('suspect-dialog').innerHTML = '<p>Selamat sore, Detektif. Ada yang bisa saya bantu?</p>';
            
            // Generate questions
            const questionsContainer = document.getElementById('interrogation-choices');
            questionsContainer.innerHTML = '';
            
            for (const [key, question] of Object.entries(character.questions)) {
                const button = document.createElement('button');
                button.className = 'choice-btn';
                button.textContent = question;
                button.onclick = () => askQuestion(key);
                questionsContainer.appendChild(button);
            }
            
            // Add back button
            const backButton = document.createElement('button');
            backButton.className = 'choice-btn';
            backButton.textContent = 'Kembali';
            backButton.onclick = endInterrogation;
            questionsContainer.appendChild(backButton);
            
            showScreen('interrogation-screen');
        }

        function askQuestion(questionType) {
            const levelInfo = levelData[gameState.currentLevel];
            const character = levelInfo.characters[gameState.currentSuspect];
            const response = character.responses[questionType];
            
            document.getElementById('suspect-dialog').innerHTML = `<p>${response}</p>`;
            
            // Record conversation
            if (!gameState.conversations[gameState.currentSuspect]) {
                gameState.conversations[gameState.currentSuspect] = {};
            }
            
            if (!gameState.conversations[gameState.currentSuspect][questionType]) {
                gameState.conversations[gameState.currentSuspect][questionType] = true;
                gameState.levelProgress[gameState.currentLevel].conversations[gameState.currentSuspect] = 
                    gameState.conversations[gameState.currentSuspect];
                
                updateProgress();
            }
            
            saveGameState();
        }

        function endInterrogation() {
            showScreen('investigation-screen');
        }

        function accuse(suspect) {
            const levelInfo = levelData[gameState.currentLevel];
            const isCorrect = suspect === levelInfo.solution;
            
            if (isCorrect) {
                alert('Selamat! Anda telah memecahkan kasus ini.');
                
                // Mark level as completed
                if (!gameState.completedLevels.includes(gameState.currentLevel)) {
                    gameState.completedLevels.push(gameState.currentLevel);
                }
                
                // Move to next level if available
                if (gameState.currentLevel < 100) {
                    gameState.currentLevel++;
                }
            } else {
                alert('Sayang sekali, Anda menuduh orang yang salah. Coba lagi!');
            }
            
            saveGameState();
            showLevelSelect();
        }

        function saveGameState() {
            localStorage.setItem('detectiveGameState', JSON.stringify({
                currentLevel: gameState.currentLevel,
                difficulty: gameState.difficulty,
                completedLevels: gameState.completedLevels,
                levelProgress: gameState.levelProgress
            }));
        }
    </script>
</body>
</html>
